<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/servable/static/css/photochop.css">
    <title>Photochop</title>
	<meta charset="utf-8" />
    <script type="text/javascript">
        function mySubmit(evnt) {
            evnt.preventDefault();
            var fInput = document.getElementById('file');
            var str = "CONFIRM FILES:";
            for (var f of fInput.files) {
                if (f.type != 'image/png'
                    && f.type != 'image/jpeg'
                    && f.type != 'image/pjpeg'
                    && f.type != 'image/gif') {
                    alert('File "' + f.name + '" isn\'t a .png, .gif, or .jpg. Convert this file, or pick another.');
                    return;
                }
		else if(f.size > 10000000) {
		    alert('This file is too large. Please make another selection.');
		    return;
		}
                str += '\n' + f.name;
            }
            if (!window.confirm(str)) return;
            var req = new XMLHttpRequest();
            req.open("POST", "/fileUpload");
            req.onreadystatechange = function () {
                if (req.readyState != XMLHttpRequest.DONE) return;
                if (req.status != 200) {
                    console.log(req);
                    alert('Upload failed!');
                    return;
                }
                alert('Upload successful');
                window.location = 'ImageCropPage.html';
            }
            req.send(fInput.files[0]);
            alert('Upload started!');
        }
        window.onload = function () {
            document.getElementById('myForm').addEventListener('submit', mySubmit);
        }
    </script>
</head>
<body>
    <h1>PhotoChop</h1>
    <form id="myForm" enctype="multipart/form-data" method="post" name="fileinfo">
        <input type="file" id="file" name="file" class="input_file" accept=".png,.jpeg,.jpg,.gif" multiple required />
        <label for="file"><img src="/servable/static/images/upload_button.png" for="input_file" /></label>
        <input type="submit" value="submit" />
    </form>
    <p>We discover the best parts of your picture</p>
</body>
</html>
